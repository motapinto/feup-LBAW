"use strict";const addEventListeners=()=>{const e=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),t=document.querySelector('meta[name="offer-id"]').getAttribute("content"),n=document.querySelector("section#offer-discounts button.btn-blue"),d=document.querySelector("section#offer-keys button.btn-blue"),s=e=>/^\w+([\-|\\|\/]\w+)*$/g.test(e),a=()=>{document.querySelectorAll("#offer-keys button.btn-red").forEach(e=>{e.addEventListener("click",()=>{b("/key/"+e.getAttribute("data-key-id")).then(t=>{200===t.status&&e.parentElement.parentElement.remove()})})})},r=e=>{let t=e.getFullYear(),n=e.getMonth()+1,d=e.getDate();return n<10&&(n="0"+n),d<10&&(d="0"+d),[t,n,d].join("-")},o=e=>/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/.test(e),l=e=>{const t=document.getElementById("offer-discounts-error"),n=e[0],d=e[1],s=e[2];return t.innerText=null,t.classList.remove("d-block"),n.classList.remove("border-danger"),d.classList.remove("border-danger"),s.classList.remove("border-danger"),null==n.value?(t.innerText="The start date must not be empty.",n.classList.add("border-danger"),t.classList.add("d-block"),!1):null==d.value?(t.innerText="The end date must not be empty.",n.classList.add("border-danger"),t.classList.add("d-block"),!1):null==s.value?(t.innerText="The discount rate must not be empty.",s.classList.add("border-danger"),t.classList.add("d-block"),!1):o(n.value)?o(d.value)?s.value<1||s.value>99?(t.innerText="The discount rate must be between 1% and 99%.",s.classList.add("border-danger"),t.classList.add("d-block"),!1):!(new Date(d.value)<=new Date(n.value))||(t.innerText="The end date must be at least one day after the start date.",n.classList.add("border-danger"),d.classList.add("border-danger"),t.classList.add("d-block"),!1):(t.innerText="The end date must be in the correct format and be valid.",d.classList.add("border-danger"),t.classList.add("d-block"),!1):(t.innerText="The start date must be in the correct format and be valid.",n.classList.add("border-danger"),t.classList.add("d-block"),!1)},c=()=>{document.querySelectorAll("#offer-discounts tbody button").forEach(e=>{e.addEventListener("click",()=>{b("/discount/"+e.getAttribute("data-discount-id")).then(t=>{200===t.status&&(e.parentElement.parentElement.remove(),i())})})})},i=()=>{const e=document.querySelectorAll("#offer-discounts tbody th");for(let t=0;t<e.length-1;t++)e[t].innerHTML=String(t+1)},u=(t,n)=>{const d={headers:{"Content-Type":"application/json",Accept:"application/json, text-plain, */*","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":e},method:"put",credentials:"same-origin",body:JSON.stringify(n)};return fetch(t,d)},b=t=>{const n={method:"delete",headers:new Headers({"Content-Type":"application/json",Accept:"application/json, text-plain, */*","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":e})};return fetch(t,n).catch(e=>console.error("Error:"+e))};d.addEventListener("click",()=>{let e=document.getElementById("offer-keys-add"),n=document.getElementById("offer-keys-error");return null==e.value||0===e.value.length?(n.innerText="The key must not be empty.",e.classList.add("border-danger"),void n.classList.add("d-block")):s(e.value)?(n.innerText=null,e.classList.remove("border-danger"),n.classList.remove("d-block"),void u(`/offer/${t}/key`,{key:e.value}).then(t=>{200===t.status?t.json().then(t=>{let n=((e,t)=>`\n            <div class="input-group mt-2">\n                <p class="form-control mr-2" readonly>${t}</p>\n                <span class="input-group-btn mt-2">\n                    <button type="button" class="btn btn-red" data-key-id="${e}"><i class="fas fa-times-circle"></i></button>\n                </span>\n            </div>\n    `)(t.id,e.value),d=document.getElementById("offer-keys-added");e.value=null,d.innerHTML+=n,a()}).catch(t=>{n.innerText=t,e.classList.add("border-danger"),n.classList.add("d-block")}):(n.innerText="The key inserted is invalid.",e.classList.add("border-danger"),n.classList.add("d-block"))}).catch(t=>{n.innerText=t,e.classList.add("border-danger"),n.classList.add("d-block")})):(n.innerText="The key inserted must have only letters and numbers and can be divided with - or \\ or /.",e.classList.add("border-danger"),void n.classList.add("d-block"))}),n.addEventListener("click",()=>{const e=document.querySelector("#offer-discounts tbody"),n=document.querySelectorAll("#offer-discounts-add input"),d=document.getElementById("offer-discounts-add"),s=document.getElementById("offer-discounts-error");if(!l(n))return;let a={start:n[0].value,end:n[1].value,rate:n[2].value};u(`/offer/${t}/discount`,a).then(t=>{200===t.status?t.json().then(t=>{let s=((e,t,n,d,s)=>{let a=document.createElement("tr");return a.innerHTML=`    \n            <th scope="row">${e}</th>\n            <td><span class="mx-auto form-control nobr" readonly>${n}</span></td>\n            <td><span class="mx-auto form-control nobr" readonly>${d}</span></td>\n            <td class="w-25"><span class="mx-auto form-control" readonly>${s}</span></td>\n            <td><button class="btn btn-red ml-2" data-discount-id="${t}"><i class="fas fa-times-circle mt-auto mb-auto d-inline-block"></i></button></td>\n        `,a})(e.children.length,t.id,n[0].value,n[1].value,n[2].value),a=new Date,o=new Date(a);o.setDate(o.getDate()+1),n[0].setAttribute("value",r(a)),n[1].setAttribute("value",r(o)),n[2].value=1,e.insertBefore(s,d),c()}).catch(e=>{s.innerText=e,d.classList.add("border-danger"),s.classList.add("d-block")}):(s.innerText="The discount inserted is invalid.",d.classList.add("border-danger"),s.classList.add("d-block"))}).catch(e=>{s.innerText=e,d.classList.add("border-danger"),s.classList.add("d-block")})}),a(),c()};addEventListeners();