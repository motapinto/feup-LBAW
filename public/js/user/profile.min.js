"use strict";const token=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),url="/user",isValidEmail=e=>/(?:[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/.test(e),isValidPassword=e=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/u.test(e),isValidDescription=e=>e.length<=500,addEventListeners=()=>{let e=document.querySelector("#email-invalid"),s=document.querySelector("#email-valid");document.querySelector("#button_submit_email").addEventListener("click",()=>{let r=document.querySelector("#form_update_user #email-input");if(isValidEmail(r.value)){const a={email:r.value};sendPost(a).then(a=>{"Success"!=a?(r.classList.contains("border-success")&&r.classList.remove("border-success"),r.className+=" border-danger",s.innerHTML="",e.innerHTML=a.errors.email):(r.classList.contains("border-danger")&&r.classList.remove("border-danger"),r.className+=" border-success",e.innerHTML="",s.innerHTML="Changed email successfully")})}else e.innerHTML="Invalid Email, choose another one",r.classList.contains("border-success")&&r.classList.remove("border-success"),r.className+=" border-danger",s.innerHTML="",r.className+=" border-danger"}),document.querySelector("#button_submit_description").addEventListener("click",()=>{const e=document.querySelector("#form_update_user #description_textarea");let s=document.querySelector("#description-invalid"),r=document.querySelector("#description-valid");if(isValidDescription(e.value)){const a={description:e.value};sendPost(a).then(a=>{"Success"!=a?(e.classList.contains("border-success")&&e.classList.remove("border-success"),r.classList.contains("d-block")&&r.classList.remove("d-block"),e.className+=" border-danger",r.innerHTML="",s.className+=" d-block",s.innerHTML=a.errors.description):(e.classList.contains("border-danger")&&e.classList.remove("border-danger"),e.classList.contains("d-block")&&e.classList.remove("d-block"),e.className+=" border-success",s.innerHTML="",r.className+=" d-block",r.innerHTML="Changed description successfully")})}else s.innerHTML="Invalid Email, choose another one",e.classList.contains("border-success")&&e.classList.remove("border-success"),r.classList.contains("d-block")&&r.classList.remove("d-block"),r.innerHTML="",e.className+=" border-danger",s.className+=" d-block",s.innerHTML="Description must have 500 or less characters"}),document.querySelector("#button_submit_password").addEventListener("click",()=>{let e=document.querySelector("#old-password-input"),s=document.querySelector("#new-password-input"),r=document.querySelector("#confirm-password-input"),a=e.value,n=s.value,c=r.value,t=document.querySelector("#new-password-invalid"),o=document.querySelector("#old-password-invalid"),d=document.querySelector("#new-password-valid"),l=!0,i=!0;if(""===a?(e.classList.contains("border-success")&&e.classList.remove("border-success"),d.innerHTML="",e.className+=" border-danger",o.innerHTML="Please fill out the old password",o.className="invalid-feedback d-block",l=!1):e.classList.contains("border-danger")&&(e.classList.remove("border-danger"),o.className="invalid-feedback"),""===n||""===c?(s.classList.contains("border-success")&&s.classList.remove("border-success"),d.innerHTML="",s.className+=" border-danger",r.className+=" border-danger",t.innerHTML="Please provide and confirm a new password",t.className="invalid-feedback d-block",i=!1):n!==c?(s.classList.contains("border-success")&&s.classList.remove("border-success"),d.innerHTML="",s.className+=" border-danger",r.className+=" border-danger",t.innerHTML="The passwords dont match",t.className="invalid-feedback d-block",i=!1):isValidPassword(n)?(t.innerHTML="",t.className="invalid-feedback",s.classList.contains("border-danger")&&s.classList.remove("border-danger"),r.classList.contains("border-danger")&&r.classList.remove("border-danger")):(s.classList.contains("border-success")&&s.classList.remove("border-success"),d.innerHTML="",s.className+=" border-danger",r.className+=" border-danger",t.innerHTML=" <p>The password needs to contains characters from this categories:</p>\n        <p>* Minimum eight characters</p>\n        <p>* At least one uppercase letter </p>\n        <p>* One lowercase letter</p>\n        <p>* One number and one special character</p>",t.className="invalid-feedback d-block",i=!1),i&&l){const a={oldPassword:e.value,newPassword:s.value,newPassword_confirmation:r.value};sendPost(a).then(a=>{"Success"!=a?(e.classList.contains("border-success")&&e.classList.remove("border-success"),s.classList.contains("border-success")&&s.classList.remove("border-success"),r.classList.contains("border-success")&&r.classList.remove("border-success"),d.innerHTML="",void 0!==a.errors.newPassword&&(s.classList.contains("border-danger")||(s.className+=" border-danger"),r.classList.contains("border-danger")||(r.className+=" border-danger"),t.innerHTML=a.errors.newPassword,t.className="invalid-feedback d-block"),void 0!==a.errors.oldPassword&&(e.classList.contains("border-danger")||(e.className+=" border-danger"),o.innerHTML=a.errors.oldPassword,o.className="invalid-feedback d-block")):(e.classList.contains("border-danger")&&e.classList.remove("border-danger"),s.classList.contains("border-danger")&&s.classList.remove("border-danger"),r.classList.contains("border-danger")&&r.classList.remove("border-danger"),e.classList.contains("border-success")||(e.className+=" border-success"),s.classList.contains("border-success")||(s.className+=" border-success"),r.classList.contains("border-success")||(r.className+=" border-success"),t.innerHTML="",o.innerHTML="",o.className="invalid-feedback",t.className="invalid-feedback",d.className="valid-feedback d-block",d.innerHTML="Changed password successfully")})}});const r=document.querySelector("#delete-account-confirmation"),a=document.querySelector("#delete-account-confirmation-input"),n=document.querySelector("#invalid-username-feedback"),c=document.querySelector("#username");r.addEventListener("click",()=>{a.value!==c.innerHTML?(a.className+=" border-danger",n.className="invalid-feedback d-block",n.innerHTML="Username doesn't match"):(a.classList.contains("border-danger")&&a.classList.remove("border-danger"),n.className="invalid-feedback",n.innerHTML="",sendDelete(c.innerHTML).then(window.location.replace("/")))}),document.querySelector("#form-img-upload").addEventListener("change",()=>{const e=document.querySelector("#img-upload").files[0],s=new FileReader;s.onload=function(){const e=document.querySelector("#profile-image"),r=document.querySelector("#profile-image-icon");e.setAttribute("src",s.result),r.setAttribute("src",s.result)},s.readAsDataURL(e),uploadFile(e)});const t=document.getElementById("appealModal-submit");if(null!=t){let e=function(){const s=document.querySelector('#appealModal textarea[name="appeal"]'),r=document.querySelector("#appealModal span#appealModal-message");s.classList.remove("border-danger"),r.classList.remove("cl-success","cl-fail","d-block"),r.textContent="",0===s.value.length?(r.classList.add("cl-fail","d-block"),r.textContent="Please give us your reasons",s.classList.add("border-danger")):sendPut({appeal:s.value}).then(s=>{r.classList.add("cl-success"),r.textContent=s.message,t.classList.add("noHover"),t.removeEventListener("click",e),document.querySelector('a[data-target="#appealModal"]').remove()}).catch(e=>{r.classList.add("cl-fail","d-block"),r.textContent=e.message})};t.addEventListener("click",e)}},sendPost=e=>{const s={headers:{"Content-Type":"application/json",Accept:"application/json, text-plain, */*","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":token},method:"post",credentials:"same-origin",body:JSON.stringify(e)};return fetch("/user/",s).then(e=>e.json()).catch(e=>{})},sendDelete=()=>{const e={method:"delete",headers:new Headers({"Content-Type":"application/json",Accept:"application/json, text-plain, */*","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":token})};return fetch(url,e).then(e=>e.json()).catch(e=>{})},uploadFile=e=>{let s=new FormData;return s.append("picture",e,e.name),fetch("/user/",{headers:{"X-CSRF-TOKEN":token},credentials:"same-origin",method:"post",contentType:!1,processData:!1,body:s}).then(e=>e.json()).catch(e=>{})},passwordIsLegal=(e,s,r)=>{if(s.value=encodeURIComponent(s.value),r.value=encodeURIComponent(r.value),/(?=.{8,})(?=.*\d)(?=.*[a-z])(?=.*[A-Z])./.test(s.value)){if(e.style.backgroundColor="white",document.getElementById("msg-password1").innerHTML="",s!==r){r.style.backgroundColor="rgb(246, 220, 220)",r.style.border="solid 1px rgb(233, 76, 76)";let s=document.createElement("p");return s.innerHTML="The password's don't match",s.style.color="red",e.parentNode.insertBefore(s,r),!1}return r.style.backgroundColor="white",r.style.border="solid 1px rgb(176, 183, 187)",e.querySelector("p").innerHTML="",!0}{let e=document.createElement("p");e.innerHTML="Enter a valid password",e.style.color="red",e.style.backgroundColor="rgb(246, 220, 220)"}return!1},sendPut=e=>{const s={headers:{"Content-Type":"application/json",Accept:"application/json, text-plain, */*","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":token},method:"put",credentials:"same-origin",body:JSON.stringify(e)};return fetch("/user/appeal",s).then(e=>e.json())};addEventListeners();