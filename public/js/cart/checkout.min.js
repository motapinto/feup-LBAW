const checkout_tab_1=document.querySelector("#checkout-tab-1"),checkout_tab_2=document.querySelector("#checkout-tab-2"),checkout_tab_3=document.querySelector("#checkout-tab-3"),comfirm_order_button=document.querySelector("#confirm-order"),your_info_button=document.querySelector("#your-info"),paypal_button=document.querySelector("#paypal-button"),input_name=document.querySelector("#checkoutInputName"),input_email=document.querySelector("#checkoutInputEmail"),input_address=document.querySelector("#checkoutInputAddress"),input_zip_code=document.querySelector("#checkoutInputZipcode"),client_name=document.querySelector("#client-name"),client_email=document.querySelector("#client-email"),client_address=document.querySelector("#client-address"),client_zip_code=document.querySelector("#client-zip-code"),name_invalid=document.querySelector("#name-invalid"),email_invalid=document.querySelector("#email-invalid"),address_invalid=document.querySelector("#address-invalid"),zip_code_invalid=document.querySelector("#zip-code-invalid"),checkout_tab_3_success=document.querySelector("#checkout-success"),checkout_tab_3_fail=document.querySelector("#checkout-fail");let valid_inputs;const addEventListenersCheckout=()=>{comfirm_order_button.addEventListener("click",clicked_confirm_button),your_info_button.addEventListener("click",clicked_info_button)},isValidEmail=e=>/(?:[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/.test(e),isValidZipCode=e=>/^[a-z0-9][a-z0-9\- ]{0,10}[a-z0-9]$/.test(e),isValidName=e=>/^[a-zA-Z]+(([',. -][a-zA-Z ])?[a-zA-Z]*)*$/.test(e),verify_input=(e,t,n,o,c)=>{""===e.value?(valid_inputs=!1,t.innerHTML=n,e.className+=" border-danger"):null==o||o(e.value)?e.classList.contains("border-danger")&&(e.classList.remove("border-danger"),t.innerHTML=""):(valid_inputs=!1,t.innerHTML=c,e.className+=" border-danger")},clicked_confirm_button=()=>{valid_inputs=!0,verify_input(input_name,name_invalid,"Please fill out your name",isValidName,"Name is not a valid one"),verify_input(input_email,email_invalid,"Please fill out your email",isValidEmail,"Please enter a valid email"),verify_input(input_address,address_invalid,"Please fill out your address"),verify_input(input_zip_code,zip_code_invalid,"Please fill out your zip-code",isValidZipCode,"Please enter a valid zip-code"),valid_inputs&&(checkout_tab_1.style.display="none",checkout_tab_2.style.display="block",client_name.innerHTML=input_name.value,client_email.innerHTML=input_email.value,client_address.innerHTML=input_address.value,client_zip_code.innerHTML=input_zip_code.value)},assembleData=()=>{let e={};return e.name=client_name.innerHTML,e.email=client_email.innerHTML,e.address=client_address.innerHTML,e.zip_code=client_zip_code.innerHTML,e},clicked_info_button=()=>{checkout_tab_1.style.display="block",checkout_tab_2.style.display="none",checkout_tab_3.style.display="none"},sendPut=e=>{const t={headers:{"Content-Type":"application/json",Accept:"application/json, text-plain, */*","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":token},method:"put",credentials:"same-origin",body:JSON.stringify(e)};return fetch("/cart/checkout",t).then(e=>e.json()).catch(e=>console.error("Error: {error}"))},sendGet=e=>{return fetch("/api/getCartTotalPrice",{headers:{"Content-Type":"application/json",Accept:"application/json, text-plain, */*","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":token},method:"get",credentials:"same-origin"}).then(e=>e.json()).catch(e=>console.error("Error: "+e))};function encodeForAjax(e){return null==e?null:Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}function check_transaction_result(e){checkout_tab_1.style.display="none",checkout_tab_2.style.display="none",!0===e.success?(checkout_tab_3.style.display="block",checkout_tab_3_success.style.display="block",checkout_tab_3_fail.style.display="none"):(checkout_tab_3.style.display="block",checkout_tab_3_success.style.display="none",checkout_tab_3_fail.style.display="block")}paypal.Button.render({braintree:braintree,client:{production:document.querySelector("#client-token").innerHTML,sandbox:document.querySelector("#client-token").innerHTML},env:"sandbox",commit:!0,payment:async function(e,t){let n=await sendGet();return t.braintree.create({flow:"checkout",amount:n.amount,currency:"USD"})},onAuthorize:function(e){const t={nonce:e.nonce,orderId:e.orderID,name:input_name.value,zipcode:input_zip_code.value,address:input_address.value,email:input_email.value};sendPut(t).then(e=>check_transaction_result(e))},locale:"en_US",style:{size:"medium",color:"gold",shape:"pill",label:"checkout",tagline:"true"}},"#paypal-button");const token=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),cartItemCounter=document.querySelector("#shopping_cart_item_counter"),counter_products_cart=document.querySelector("#counter_products_cart"),url="/cart",totalPrice=document.querySelector("#total_price");let totalPriceNumber=0;const addEventListeners=()=>{document.querySelectorAll(".remove_cart_button").forEach(e=>{e.addEventListener("click",()=>{event.preventDefault();const t=e.getAttribute("data_cart_id"),n=parseFloat(e.getAttribute("value_offer")).toFixed(2);e.disabled=!0,sendDelete(t,n).then(async()=>{let e=await sendGet();totalPrice.innerHTML="$"+e.amount.toFixed(2),0===e.amount&&window.location.replace("/cart")})})})},sendDelete=(e,t)=>{const n={method:"delete",headers:new Headers({"Content-Type":"application/json",Accept:"application/json, text-plain, */*","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":token})};return fetch(url+"/"+e,n).then(function(n){if(n.json(),n.ok){let n=parseFloat(totalPrice.innerHTML).toFixed(2);n-=t,totalPrice.innerHTML="$"+n.toFixed(2),document.querySelector("#row"+e).remove(),cartItemCounter.innerHTML=cartItemCounter.innerHTML-1,counter_products_cart.innerHTML=counter_products_cart.innerHTML-1,0===n&&window.location.replace("/")}}).catch(e=>console.error("Error:"+e))};document.querySelectorAll(".remove_cart_button").forEach(e=>{e.addEventListener("click",()=>{event.preventDefault();const t=e.getAttribute("data_cart_id"),n=parseFloat(e.getAttribute("value_offer")).toFixed(2);e.disabled=!0,sendDelete(t,n).then(async()=>{let e=await sendGet();totalPrice.innerHTML="$"+e.amount.toFixed(2),0===e.amount&&window.location.replace("/cart")})})}),comfirm_order_button.addEventListener("click",clicked_confirm_button),your_info_button.addEventListener("click",clicked_info_button);