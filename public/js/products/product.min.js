const token=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),btnText=document.getElementById("moreTextButton"),dots=document.getElementById("dots"),moreText=document.getElementById("more"),seeMoreButtons=document.getElementById("see-more-buttons"),readmoreText=document.querySelector("#text-readmore");let allAddToCartButtons=document.querySelectorAll(".button-offer");const radioButtons=document.getElementById("radio-buttons"),collapseDescription=()=>{"none"===dots.style.display?(dots.style.display="inline",btnText.innerHTML="Read more",moreText.style.display="none"):(dots.style.display="none",btnText.innerHTML="Read less",moreText.style.display="inline")};readmoreText.textContent.length<200?btnText.style.display="none":(btnText.addEventListener("click",collapseDescription),btnText.style.display="block");const htmlToInsertWithoutOffers='<div class="col-sm-12 text-center align-middle"> <p class = "mt-5" >No offers available for this product</p> </div >',cartItemCounter=document.querySelector("#shopping_cart_item_counter"),counterNumberOffers=document.querySelector("#counter-number-offers"),htmlToInsertPlace=document.querySelector("#offers-content"),sendPut=e=>{const t={headers:{"Content-Type":"application/json",Accept:"application/json, text-plain, */*","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":token},method:"put",credentials:"same-origin",body:JSON.stringify(e)};let o=document.querySelectorAll(".button-offer"),n=null;return o.forEach(t=>{t.getAttribute("data-offer")===e.offer_id&&(n=t)}),n.disabled=!0,fetch("/cart/",t).then(function(t){if(t.ok){cartItemCounter.innerHTML=parseInt(cartItemCounter.innerHTML)+1;let t=document.querySelector("#offer-"+e.offer_id+"-stock");if(t.innerHTML-=1,n.disabled=!1,"0"==t.innerHTML){document.querySelector("#entry-offer-"+e.offer_id).remove(),counterNumberOffers.innerHTML-=1,"0"!==counterNumberOffers.innerHTML||radioButtons.classList.contains("d-none")||(radioButtons.className+=" d-none",htmlToInsertPlace.innerHTML=htmlToInsertWithoutOffers)}}t.json()}).catch(e=>console.error("Error:"+e))},addEventListenerAddToCardButton=()=>{(allAddToCartButtons=document.querySelectorAll(".button-offer")).forEach(e=>{e.addEventListener("click",()=>{let t={offer_id:e.getAttribute("data-offer")};sendPut(t)})})};addEventListenerAddToCardButton();const sendGet=e=>{const t={headers:{"Content-Type":"application/json",Accept:"application/json, text-plain, */*","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":token},method:"get",credentials:"same-origin"};return fetch(`/api${window.location.pathname}/sort?`+encodeForAjax(e),t).then(e=>e.text()).catch(e=>console.error("Error: "+e))};let radioBestRating=document.querySelector("#radio_best_rating"),radioBestPrice=document.querySelector("#radio_best_price"),seeMoreOffers=document.querySelector("#see_more_offers"),closeMoreOffers=document.querySelector("#close_more_offers"),loadingMoreOffers=document.querySelector("#loading_offers");null!=seeMoreOffers&&null!=closeMoreOffers&&(seeMoreOffers.addEventListener("click",collapseOffers),closeMoreOffers.addEventListener("click",collapseOffers));const received=e=>{document.querySelector("#offers_body").innerHTML=e,addEventListenerAddToCardButton()},receivedAll=e=>{document.querySelector("#offers_body").innerHTML=e,addEventListenerAddToCardButton()};let changedSortBy=!0;async function collapseOffers(){let e=document.querySelectorAll("#offers_body > tr");if("none"===seeMoreOffers.style.display||seeMoreOffers.classList.contains("d-none")){seeMoreOffers.style.display="block",closeMoreOffers.style.display="none";for(let t=0;t<e.length;t++)t>=10&&(e[t].style.display="none")}else if("none"===closeMoreOffers.style.display||closeMoreOffers.classList.contains("d-none")){changedSortBy&&(seeMoreOffers.style.display="none",loadingMoreOffers.style.display="block",await sendRequestForAllOffers(),changedSortBy=!1),loadingMoreOffers.style.display="none",closeMoreOffers.style.display="block",seeMoreOffers.style.display="none";for(let t=0;t<e.length;t++)e[t].style.display="table-row"}}const sendRequest=()=>{changedSortBy=!0;let e=assembleData(!1);sendGet(e).then(e=>received(e)).catch(e=>console.error("Error: "+e))},sendRequestForAllOffers=async()=>{let e=assembleData(!0);await sendGet(e).then(e=>receivedAll(e)).catch(e=>console.error("Error: "+e))};function assembleData(e){let t={};return radioBestRating.checked?t.sort_by=2:t.sort_by=1,t.all_offers=e?1:0,t}function encodeForAjax(e){return null==e?null:Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}radioBestPrice.addEventListener("click",sendRequest),radioBestRating.addEventListener("click",sendRequest);